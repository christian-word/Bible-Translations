<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Мультиверсионная Библия</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2563eb;
            --primary-dark: #1d4ed8;
            --bg-main: #f8fafc;
            --bg-card: #ffffff;
            --text-primary: #0f172a;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --accent-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-main);
            color: var(--text-primary);
            line-height: 1.7;
            font-size: 16px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: var(--accent-gradient);
            color: white;
            padding: 24px 0;
            margin-bottom: 32px;
            box-shadow: var(--shadow-lg);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 16px;
        }

        h1 {
            font-size: 28px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .controls {
            background: var(--bg-card);
            padding: 24px;
            border-radius: 16px;
            box-shadow: var(--shadow);
            margin-bottom: 24px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            align-items: end;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        select, input {
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 16px;
            background: var(--bg-card);
            transition: all 0.2s;
            font-family: inherit;
        }

        select:focus, input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        button {
            padding: 12px 24px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        button:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        button:active {
            transform: translateY(0);
        }

        .versions-toolbar {
            background: var(--bg-card);
            padding: 16px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 24px;
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
        }

        .version-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: var(--bg-main);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
        }

        .version-toggle:hover {
            background: #e2e8f0;
        }

        .version-toggle.active {
            background: var(--primary-color);
            color: white;
        }

        .version-toggle input[type="checkbox"] {
            margin: 0;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .verses-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .version-column {
            background: var(--bg-card);
            border-radius: 16px;
            box-shadow: var(--shadow);
            overflow: hidden;
            transition: all 0.3s;
        }

        .version-column.hidden {
            display: none;
        }

        .version-header {
            padding: 20px;
            background: var(--accent-gradient);
            color: white;
            font-weight: 600;
            font-size: 18px;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .verse-list {
            padding: 20px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .verse-item {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            gap: 12px;
            transition: background 0.2s;
        }

        .verse-item:last-child {
            border-bottom: none;
        }

        .verse-item:hover {
            background: #f1f5f9;
            border-radius: 8px;
        }

        .verse-number {
            font-weight: 700;
            color: var(--primary-color);
            min-width: 36px;
            font-size: 14px;
            text-align: center;
            background: #e0e7ff;
            border-radius: 6px;
            padding: 4px 8px;
            height: fit-content;
        }

        .verse-text {
            flex: 1;
            font-size: 17px;
            line-height: 1.8;
            color: var(--text-primary);
        }

        /* Мобильный режим */
        .mobile-view {
            display: none;
        }

        .mobile-selector {
            background: var(--bg-card);
            padding: 16px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .mobile-version-btn {
            flex: 1;
            min-width: 120px;
            padding: 10px;
            background: var(--bg-main);
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            font-weight: 600;
        }

        .mobile-version-btn.active {
            border-color: var(--primary-color);
            background: var(--primary-color);
            color: white;
        }

        .compare-mode-toggle {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-left: auto;
            padding: 8px 16px;
            background: var(--bg-main);
            border-radius: 8px;
            cursor: pointer;
            user-select: none;
        }

        .compare-mode-toggle input {
            margin: 0;
        }

        /* Адаптивность */
        @media (max-width: 768px) {
            .container {
                padding: 12px;
            }

            h1 {
                font-size: 22px;
            }

            .controls {
                grid-template-columns: 1fr;
                padding: 16px;
                gap: 12px;
            }

            .desktop-view {
                display: none;
            }

            .mobile-view {
                display: block;
            }

            .versions-toolbar {
                padding: 12px;
                gap: 8px;
            }

            .verse-list {
                padding: 16px;
                max-height: none;
            }

            .verse-item {
                padding: 12px;
            }

            .verse-text {
                font-size: 16px;
            }
        }

        /* Утилиты */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
            font-size: 18px;
        }

        .error {
            background: #fee2e2;
            color: #991b1b;
            padding: 16px;
            border-radius: 8px;
            border-left: 4px solid #dc2626;
            margin-bottom: 20px;
        }

        .success {
            background: #dcfce7;
            color: #166534;
            padding: 16px;
            border-radius: 8px;
            border-left: 4px solid #16a34a;
            margin-bottom: 20px;
        }

        /* Полоса прокрутки */
        .verse-list::-webkit-scrollbar {
            width: 8px;
        }

        .verse-list::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        .verse-list::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        .verse-list::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <h1>📖 Мультиверсионная Библия</h1>
            <div class="compare-mode-toggle">
                <input type="checkbox" id="compareMode">
                <label for="compareMode">Режим сравнения</label>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Управление -->
        <div class="controls">
            <div class="control-group">
                <label for="bookSelect">Книга</label>
                <select id="bookSelect">
                    <option value="">Выберите книгу</option>
                </select>
            </div>
            <div class="control-group">
                <label for="chapterSelect">Глава</label>
                <select id="chapterSelect" disabled>
                    <option value="">Выберите главу</option>
                </select>
            </div>
            <div class="control-group">
                <label for="verseSelect">Стих (опционально)</label>
                <input type="number" id="verseSelect" placeholder="№ стиха" min="1">
            </div>
            <div class="control-group">
                <button id="loadBtn" onclick="loadVerses()">Загрузить</button>
            </div>
        </div>

        <!-- Информационные сообщения -->
        <div id="messageContainer"></div>

        <!-- Панель выбора переводов (десктоп) -->
        <div class="versions-toolbar desktop-view" id="versionsToolbar">
            <span style="font-weight: 600; color: var(--text-secondary);">Показывать переводы:</span>
        </div>

        <!-- Мобильная панель выбора перевода -->
        <div class="mobile-view">
            <div class="mobile-selector" id="mobileSelector">
                <span style="font-weight: 600; color: var(--text-secondary);">Выбранный перевод:</span>
            </div>
        </div>

        <!-- Контейнер для стихов -->
        <div id="versesContainer" class="verses-container desktop-view">
            <div class="loading">Выберите книгу и главу для начала работы</div>
        </div>

        <!-- Мобильное отображение -->
        <div id="mobileVersesContainer" class="mobile-view">
            <div class="loading">Выберите книгу и главу для начала работы</div>
        </div>
    </div>

    <script>
        // Конфигурация переводов
        const translations = [
            { id: 'HOM', name: 'Хоменко', fullName: 'Український переклад Хоменка', lang: 'uk' },
            { id: 'UBIO', name: 'Огієнко', fullName: 'Український переклад Огієнка', lang: 'uk' },
            { id: 'UTT', name: 'Турконяк', fullName: 'Сучасний український переклад', lang: 'uk' },
            { id: 'NRT', name: 'Новый', fullName: 'Новый русский перевод', lang: 'ru' },
            { id: 'SYNOD', name: 'Синодальный', fullName: 'Синодальный перевод', lang: 'ru' }
        ];

        // Состояние приложения
        const appState = {
            currentBook: null,
            currentChapter: null,
            currentVerse: null,
            activeVersions: new Set(['HOM', 'NRT']), // По умолчанию 2 перевода
            compareMode: false,
            data: {}
        };

        // Инициализация
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            loadBooks();
            setupEventListeners();
        });

        function initializeApp() {
            // Создаем переключатели переводов
            createVersionToggles();
            
            // Загружаем данные переводов
            loadTranslations();
        }

        function createVersionToggles() {
            const toolbar = document.getElementById('versionsToolbar');
            const mobileSelector = document.getElementById('mobileSelector');
            
            translations.forEach(trans => {
                // Десктопная версия (чекбоксы)
                const label = document.createElement('label');
                label.className = 'version-toggle active';
                label.innerHTML = `
                    <input type="checkbox" value="${trans.id}" checked onchange="toggleVersion('${trans.id}')">
                    <span>${trans.name}</span>
                `;
                toolbar.appendChild(label);
                
                // Мобильная версия (кнопки)
                const btn = document.createElement('button');
                btn.className = 'mobile-version-btn';
                btn.textContent = trans.name;
                btn.onclick = () => selectMobileVersion(trans.id);
                mobileSelector.appendChild(btn);
            });
            
            // Устанавливаем активную мобильную кнопку
            updateMobileButtons();
        }

        function setupEventListeners() {
            document.getElementById('compareMode').addEventListener('change', (e) => {
                appState.compareMode = e.target.checked;
                if (appState.currentBook && appState.currentChapter) {
                    loadVerses();
                }
            });
        }

        async function loadTranslations() {
            showMessage('Загрузка переводов...', 'info');
            
            try {
                // Загрузка всех переводов
                const promises = translations.map(async trans => {
                    try {
                        const response = await fetch(`${trans.id}_${trans.name}.json`);
                        if (!response.ok) throw new Error(`Файл ${trans.id} не найден`);
                        appState.data[trans.id] = await response.json();
                    } catch (error) {
                        console.warn(`Не удалось загрузить ${trans.id}, используем демо-данные`);
                        // Демо-данные для тестирования
                        appState.data[trans.id] = getDemoData();
                    }
                });
                
                await Promise.allSettled(promises);
                showMessage('Переводы загружены!', 'success');
                
            } catch (error) {
                showMessage('Ошибка загрузки переводов: ' + error.message, 'error');
            }
        }

        function getDemoData() {
            // Демо-данные для тестирования (Бытие 1-2)
            return {
                "Бытие": {
                    "1": {
                        "1": "В начале сотворил Бог небо и землю.",
                        "2": "Земля была безвидна и пуста, и тьма над бездною, и Дух Божий носился над водою.",
                        "3": "И сказал Бог: да будет свет. И стал свет.",
                        "4": "И увидел Бог свет, что он хорош, и отделил Бог свет от тьмы.",
                        "5": "И назвал Бог свет днем, а тьму ночью. И был вечер, и было утро: день один."
                    },
                    "2": {
                        "1": "Так совершены небо и земля и все воинство их.",
                        "2": "И совершил Бог в день седьмой дело свое, которое творил, и возвратился в день седьмый от всех дел своих, которые творил."
                    }
                }
            };
        }

        function loadBooks() {
            const bookSelect = document.getElementById('bookSelect');
            
            // Получаем список книг из первого доступного перевода
            const firstTrans = translations[0].id;
            if (appState.data[firstTrans]) {
                const books = Object.keys(appState.data[firstTrans]);
                books.forEach(book => {
                    const option = document.createElement('option');
                    option.value = book;
                    option.textContent = book;
                    bookSelect.appendChild(option);
                });
            }
            
            bookSelect.addEventListener('change', onBookChange);
        }

        function onBookChange(e) {
            const book = e.target.value;
            const chapterSelect = document.getElementById('chapterSelect');
            
            if (!book) {
                chapterSelect.disabled = true;
                return;
            }
            
            // Очищаем и загружаем главы
            chapterSelect.innerHTML = '<option value="">Выберите главу</option>';
            const firstTrans = translations[0].id;
            
            if (appState.data[firstTrans] && appState.data[firstTrans][book]) {
                const chapters = Object.keys(appState.data[firstTrans][book]).sort((a, b) => a - b);
                chapters.forEach(chapter => {
                    const option = document.createElement('option');
                    option.value = chapter;
                    option.textContent = `Глава ${chapter}`;
                    chapterSelect.appendChild(option);
                });
                chapterSelect.disabled = false;
            }
        }

        function toggleVersion(versionId) {
            const checkbox = document.querySelector(`input[value="${versionId}"]`);
            if (checkbox.checked) {
                appState.activeVersions.add(versionId);
            } else {
                if (appState.activeVersions.size > 1) {
                    appState.activeVersions.delete(versionId);
                } else {
                    checkbox.checked = true; // Не позволяем отключить все
                    showMessage('Должен быть активен хотя бы один перевод', 'error');
                    return;
                }
            }
            
            if (appState.currentBook && appState.currentChapter) {
                loadVerses();
            }
        }

        function selectMobileVersion(versionId) {
            appState.activeVersions.clear();
            appState.activeVersions.add(versionId);
            updateMobileButtons();
            
            if (appState.currentBook && appState.currentChapter) {
                loadMobileVerses();
            }
        }

        function updateMobileButtons() {
            const buttons = document.querySelectorAll('.mobile-version-btn');
            buttons.forEach(btn => {
                const versionId = translations.find(t => t.name === btn.textContent)?.id;
                if (versionId && appState.activeVersions.has(versionId)) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        async function loadVerses() {
            const book = document.getElementById('bookSelect').value;
            const chapter = document.getElementById('chapterSelect').value;
            const verse = document.getElementById('verseSelect').value;
            
            if (!book || !chapter) {
                showMessage('Пожалуйста, выберите книгу и главу', 'error');
                return;
            }
            
            appState.currentBook = book;
            appState.currentChapter = chapter;
            appState.currentVerse = verse || null;
            
            // Десктопный режим
            if (window.innerWidth > 768 || appState.compareMode) {
                loadDesktopVerses();
            } else {
                loadMobileVerses();
            }
        }

        function loadDesktopVerses() {
            const container = document.getElementById('versesContainer');
            container.innerHTML = '<div class="loading">Загрузка...</div>';
            
            const versions = Array.from(appState.activeVersions);
            const html = versions.map(versionId => {
                const trans = translations.find(t => t.id === versionId);
                return createVersionColumn(trans);
            }).join('');
            
            container.innerHTML = html;
        }

        function loadMobileVerses() {
            const container = document.getElementById('mobileVersesContainer');
            container.innerHTML = '<div class="loading">Загрузка...</div>';
            
            // Отображаем только один выбранный перевод
            const versionId = Array.from(appState.activeVersions)[0];
            const trans = translations.find(t => t.id === versionId);
            
            const html = createVersionColumn(trans);
            container.innerHTML = html;
        }

        function createVersionColumn(trans) {
            const data = appState.data[trans.id];
            if (!data || !data[appState.currentBook] || !data[appState.currentBook][appState.currentChapter]) {
                return `<div class="version-column">
                    <div class="version-header">${trans.fullName}</div>
                    <div class="verse-list">Перевод не найден</div>
                </div>`;
            }
            
            const verses = data[appState.currentBook][appState.currentChapter];
            const verseNumbers = appState.currentVerse 
                ? [appState.currentVerse] 
                : Object.keys(verses).sort((a, b) => a - b);
            
            const versesHtml = verseNumbers.map(num => `
                <div class="verse-item">
                    <div class="verse-number">${num}</div>
                    <div class="verse-text">${verses[num] || 'Стих не найден'}</div>
                </div>
            `).join('');
            
            return `
                <div class="version-column">
                    <div class="version-header">${trans.fullName}</div>
                    <div class="verse-list">${versesHtml}</div>
                </div>
            `;
        }

        function showMessage(text, type = 'info') {
            const container = document.getElementById('messageContainer');
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : '';
            const icon = type === 'error' ? '⚠️' : type === 'success' ? '✅' : 'ℹ️';
            
            container.innerHTML = `<div class="${className}">${icon} ${text}</div>`;
            
            if (type !== 'error') {
                setTimeout(() => {
                    container.innerHTML = '';
                }, 3000);
            }
        }

        // Обработка изменения размера окна
        let resizeTimer;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => {
                if (appState.currentBook && appState.currentChapter) {
                    loadVerses();
                }
            }, 250);
        });
    </script>
</body>
</html>